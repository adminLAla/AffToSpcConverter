<Window x:Class="AffToSpcConverter.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="设置" Height="620" Width="560"
        WindowStartupLocation="CenterOwner">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0">
            <StackPanel>

                <!-- 映射规则 -->
                <GroupBox Header="映射规则" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Width="180" VerticalAlignment="Center" Text="映射规则"/>
                            <ComboBox Width="200" SelectedValue="{Binding MappingRule}" SelectedValuePath="Content">
                                <ComboBoxItem Content="暴力映射(不推荐)"/>
                                <ComboBoxItem Content="自建规则"/>
                            </ComboBox>
                        </StackPanel>
                        <Button Width="200" HorizontalAlignment="Left" Margin="180,0,0,0"
                                Click="OpenCustomMapping_Click"
                                Content="编辑自建规则..."/>
                    </StackPanel>
                </GroupBox>

                <!-- 难度 / 混音（可选） -->
                <GroupBox Header="难度 / 混音（可选）" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <CheckBox Content="启用 Tap 宽度样式" IsChecked="{Binding TapWidthPatternEnabled}" Margin="0,0,0,6"/>

                        <StackPanel Orientation="Horizontal" Margin="22,0,0,6">
                            <TextBlock Width="180" VerticalAlignment="Center" Text="样式（如 1,2,1,2）"/>
                            <TextBox Width="200" Text="{Binding TapWidthPattern}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="22,0,0,6">
                            <TextBlock Width="180" VerticalAlignment="Center" Text="密集阻值（ms，0=自动）"/>
                            <TextBox Width="100" Text="{Binding DenseTapThresholdMs}"/>
                        </StackPanel>

                        <CheckBox Content="随机化 Hold 宽度" IsChecked="{Binding HoldWidthRandomEnabled}" Margin="0,12,0,6"/>

                        <StackPanel Orientation="Horizontal" Margin="22,0,0,6">
                            <TextBlock Width="180" VerticalAlignment="Center" Text="最大 Hold 宽度"/>
                            <TextBox Width="100" Text="{Binding HoldWidthRandomMax}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="22,0,0,0">
                            <TextBlock Width="180" VerticalAlignment="Center" Text="随机稿子"/>
                            <TextBox Width="100" Text="{Binding RandomSeed}"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="天空（可选）" Margin="0,10,0,0">
                    <StackPanel Margin="10">
                        <CheckBox Content="SkyArea 第二策略（表现型）" IsChecked="{Binding SkyareaStrategy2}"/>
                    </StackPanel>
                </GroupBox>

                <!-- 高级设置 -->
                <GroupBox Header="高级设置" Margin="0,10,0,0">
                    <StackPanel Margin="10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Width="220" VerticalAlignment="Center" Text="全局时间偏移（ms）"/>
                            <TextBox Width="100" Text="{Binding GlobalTimeOffsetMs}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Width="220" VerticalAlignment="Center" Text="最小 Hold 时长（ms，短于此转为 Tap）"/>
                            <TextBox Width="100" Text="{Binding MinHoldDurationMs}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Width="220" VerticalAlignment="Center" Text="最小 SkyArea 时长（ms，短于此丢弃）"/>
                            <TextBox Width="100" Text="{Binding MinSkyAreaDurationMs}"/>
                        </StackPanel>

                        <CheckBox Content="输出 BPM 变速事件" IsChecked="{Binding OutputBpmChanges}" Margin="0,0,0,6"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Width="220" VerticalAlignment="Center" Text="Tap 去重阈值（ms，0=不合并）"/>
                            <TextBox Width="100" Text="{Binding DeduplicateTapThresholdMs}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Width="220" VerticalAlignment="Center" Text="排序模式"/>
                            <ComboBox Width="140" SelectedValue="{Binding SortMode}" SelectedValuePath="Content">
                                <ComboBoxItem Content="timeFirst"/>
                                <ComboBoxItem Content="typeFirst"/>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="预览（可选）" Margin="0,10,0,0">
                    <StackPanel Margin="10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Width="180" VerticalAlignment="Center" Text="目标 FPS"/>
                            <ComboBox Width="160" SelectedValuePath="Content" SelectedValue="{Binding PreviewTargetFps}">
                                <ComboBoxItem Content="60"/>
                                <ComboBoxItem Content="120"/>
                                <ComboBoxItem Content="144"/>
                                <ComboBoxItem Content="165"/>
                            </ComboBox>
                        </StackPanel>
                        <CheckBox Content="启用 VSync（跟随显示器刷新）" IsChecked="{Binding PreviewUseVsync}" Margin="0,0,0,6"/>
                        <TextBlock Text="启用 VSync 时，目标 FPS 仅在关闭 VSync 后生效。"
                                   Foreground="#777777" FontSize="11" Margin="22,0,0,6"/>
                        <CheckBox Content="显示 FPS/ft/P95/P99" IsChecked="{Binding ShowFpsStats}"/>
                        <CheckBox Content="播放时鼠标不可选中音符" IsChecked="{Binding DisableNoteSelectionWhilePlaying}" Margin="0,8,0,6"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                            <TextBlock Width="180" VerticalAlignment="Center" Text="编辑音符触发方式"/>
                            <ComboBox Width="220" SelectedValuePath="Tag" SelectedValue="{Binding PreviewNoteEditTriggerMode}">
                                <ComboBoxItem Tag="single" Content="鼠标左键单击音符编辑"/>
                                <ComboBoxItem Tag="double" Content="鼠标左键双击音符编辑"/>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Width="90" Margin="0,0,8,0" IsDefault="True" Click="Ok_Click">确定</Button>
            <Button Width="90" IsCancel="True">取消</Button>
        </StackPanel>
    </Grid>
</Window>
